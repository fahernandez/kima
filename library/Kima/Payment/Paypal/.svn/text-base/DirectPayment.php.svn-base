<?php
/**
 * Yeah Paypal Handler
 *
 * @author Steavy Vega <steavy.vega@possibleworldwide.com>
 * @package Payment
 * @subpackage Paypal
 */

/**
 * Yeah Namespace, PHP 5.3 <
 */
namespace Yeah\Payment\Paypal;

/**
 * Namespaces to use
 */
use Yeah\Payment\Paypal; 

/**
 * Files to include
 */
require_once('Yeah/Payment/Paypal.php');

/**
 * Yeah Paypal Class
 *
 * @package Yeah
 * @subpackage Paypal
 */
class DirectPayment extends Paypal
{
    /**
     * API method name
     */
    const METHOD = 'DoDirectPayment';
    
    /**
     * API method required fields
     */
    private $_requiredFields = array(
        'ACCT',             // Credit card number
        'EXPDATE',          // Expiration date in MMYYYY format 
        'FIRSTNAME',        // Credit card fisrt name
        'LASTNAME',         // Credit card last name
        'STREET',           // Address street
        'CITY',             // Address city
        'STATE',            // Address state check https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&content_ID=developer/e_howto_api_nvp_StateandProvinceCodes
        'ZIP',              // Address ZIP
        'COUNTRYCODE',      // Country, check https://cms.paypal.com/es/cgi-bin/?cmd=_render-content&content_ID=developer/e_howto_api_soap_country_codes
        'AMT'               // Item cost
    );
    
    /**
     * Makes a direct payment using Paypal
     * @see https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&content_ID=developer/e_howto_api_nvp_r_DoDirectPayment
     * @param array $params
     */
    public function doDirectPayment($params)
    {
        $this->_validateRequiredFields($params, $this->_requiredFields, self::METHOD);

        $response = $this->apiRequest(self::METHOD, $params);
        
        if ('SUCCESS' == $response['ACK'] || 'SUCCESSWITHWARNING' == $response['ACK']) {
            return $response;
        }
        
        $this->setErrorResponse($response, self::METHOD);
        return false;
    }
    
}